# Teil 1: Malware & Threat Intelligence Grundlagen

## Was ist Malware?

**Malware = Malicious Software (BÃ¶sartige Software)**

Jedes Programm, das absichtlich entwickelt wurde fÃ¼r:

- ğŸš« StÃ¶rung
- ğŸ’° Diebstahl
- ğŸ”“ Unbefugten Zugriff

**Was unterscheidet Malware von Bugs?** â†’ **Die Absicht!**

Moderne Malware wird entwickelt von:

- Organisierten Gruppen
- Nationalstaaten
- FÃ¼r Profit, Spionage, Sabotage, Aktivismus

---

## Der Malware-Lebenszyklus

```
1. DELIVERY (Auslieferung)
   â†“
   Phishing-E-Mails, malicious Links, Exploits, infizierte Medien
   
2. EXECUTION (AusfÃ¼hrung)
   â†“
   User Ã¶ffnet oder Schwachstelle wird ausgenutzt
   
3. ACTION (Aktion)
   â†“
   Ziel erreichen: VerschlÃ¼sseln, Stehlen, C2-Kommunikation
```

---

## Malware-Familien

### 1. Viren & WÃ¼rmer

- **Verbreiten sich** automatisch
- Infizieren andere Dateien/Systeme

### 2. Trojaner

- **Tarnen sich** als vertrauenswÃ¼rdige Programme
- "Trojanisches Pferd" - sieht harmlos aus

### 3. Ransomware

- **VerschlÃ¼sselt Dateien**
- Erpresst LÃ¶segeld

### 4. Spyware

- **Zeichnet auf**, was User tun
- Keylogger, Bildschirmaufnahmen

### 5. Rootkits

- **Verstecken sich** im System
- Behalten Kontrolle, schwer zu entdecken

---

## Indicators of Compromise (IoC)

**Digitale Spuren, die Malware hinterlÃ¤sst**

### Wichtigste IoCs:

**1. Datei-Hashes**

```
MD5:    d41d8cd98f00b204e9800998ecf8427e
SHA-1:  da39a3ee5e6b4b0d3255bfef95601890afd80709
SHA-256: e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855
```

**2. IP-Adressen & Domains**

- Wohin verbindet sich Malware?
- Command & Control Server (C2)

**3. Dateipfade**

```
C:\Windows\Temp\malicious.exe
%AppData%\Roaming\BadFile.dll
```

**4. Registry-Keys**

```
HKCU\Software\Microsoft\Windows\CurrentVersion\Run
```

**5. URLs**

```
http://evil-c2-server.com/payload.exe
```

---

## Command & Control (C2) Server

**Externer Server, von Angreifern kontrolliert**

### Was macht ein C2?

1. **Anweisungen senden** â†’ Was soll Malware tun?
2. **Payloads liefern** â†’ Weitere Schadsoftware
3. **Daten empfangen** â†’ Gestohlene Informationen

### Warum C2-IoCs so wertvoll?

â†’ **Blockieren = Malware neutralisieren!** (Auch wenn sie noch auf dem Host lÃ¤uft)

---

## Cyber Threat Intelligence (CTI)

**IoCs im Kontext verbinden = GroÃŸes Bild sehen**

### Von IoC zu Intelligence:

```
Einzelner Hash
    â†“
Verbindung zu IP
    â†“
IP gehÃ¶rt zu Domain
    â†“
Domain hat weitere Samples
    â†“
â†’ Komplette Kampagne aufgedeckt!
```

### Pyramide des Schmerzes

```
        /\
       /  \  â† TTPs (Tactics, Techniques, Procedures)
      /    \                    = SCHMERZHAFT zu Ã¤ndern
     /______\ â† Tools
    /        \ â† Network/Host Artifacts
   /__________\ â† Domain Names
  /____________\ â† IP Addresses
 /______________\ â† Hash Values = TRIVIAL zu Ã¤ndern
```

**Je hÃ¶her in der Pyramide, desto mehr Aufwand fÃ¼r Angreifer!**

---

## VirusTotal

**Kostenlose, community-getriebene Plattform**

### Was kann VirusTotal?

1. **Files scannen** â†’ Hochladen & analysieren
2. **URLs prÃ¼fen** â†’ Ist dieser Link gefÃ¤hrlich?
3. **Domains suchen** â†’ Bekannte C2-Server?
4. **IPs recherchieren** â†’ Malicious Hosts?

### Warum so mÃ¤chtig?

- Aggregiert **60+ Antivirus-Engines**
- Zeigt **Beziehungen zwischen IoCs**
- Community-Kommentare & Intelligence

### Der Pivot-Prozess:

```
File-Hash suchen
    â†“
Findet verwandte Domains
    â†“
Domain zeigt weitere IPs
    â†“
IPs zeigen andere Samples
    â†“
â†’ Ganze Malware-Familie entdeckt!
```

---

# Teil 2: Statische Malware-Analyse

## Was ist statische Analyse?

**Malware untersuchen OHNE sie auszufÃ¼hren**

**Analogie:** Blueprints eines GebÃ¤udes lesen, statt durchzugehen

### Ziele:

- âœ… Ist die Datei bÃ¶sartig?
- ğŸ” Welche FÃ¤higkeiten hat sie?
- ğŸ“Š Wie ausgeklÃ¼gelt ist sie?
- ğŸ›¡ï¸ Erste Defenses entwickeln

**Vorteil:** Komplett sicher!

---

## Schritt 1: Datei-Hashing

### Warum Hashes?

**Hash = Digitaler Fingerabdruck**

```
Datei: malware.exe
â†“
SHA-256: 3f786850e387550fdab8...
```

**Selbst 1 Bit Ã„nderung = Komplett anderer Hash!**

### 3 Verwendungszwecke:

**1. Identifikation**

- Eindeutiger Name fÃ¼r Sample

**2. Threat Intelligence**

- In VirusTotal suchen
- Wurde schon analysiert?

**3. IntegritÃ¤t**

- Alle schauen auf exakt dieselbe Datei

### GÃ¤ngige Hash-Algorithmen:

- **MD5** (128 bit) - veraltet, aber noch genutzt
- **SHA-1** (160 bit) - legacy
- **SHA-256** (256 bit) - **Standard heute**

---

## Schritt 2: String-Extraktion

**Alle lesbaren Zeichen aus der Datei ziehen**

### Was finden wir?

**1. Debugging-Info**

```
"Error: Cannot connect to server"
"Debug mode enabled"
```

**2. Netzwerk-Ziele**

```
"http://evil-c2.com"
"192.168.1.100"
```

**3. Dateipfade**

```
"C:\Windows\System32\evil.dll"
"%TEMP%\payload.exe"
```

**4. Funktionsnamen**

```
"CreateRemoteThread"
"VirtualAllocEx"
"WriteProcessMemory"
```

**5. Versteckte Nachrichten**

```
"Created by HackerGroup123"
```

### Das Problem: Obfuscation

**Malware-Autoren wissen das!**

â†’ Strings werden **verschleiert/verschlÃ¼sselt**

**LÃ¶sung:** Tool wie **FLOSS** (Flare Obfuscated String Solver)

- Dekodiert verschleierte Strings
- Findet versteckte URLs/IPs

---

## Schritt 3: PE-Header Analyse

### Was ist PE? (Portable Executable)

**Standard fÃ¼r Windows-Programme**

Das PE-Format ist wie ein **Inhaltsverzeichnis** fÃ¼r .exe-Dateien

---

## Windows API & DLLs verstehen

### Das Problem ohne APIs:

Jedes Programm mÃ¼sste eigenen Code schreiben fÃ¼r:

- Datei Ã¶ffnen
- Internet-Verbindung
- Fenster zeichnen

**Chaos!**

### Die LÃ¶sung: Windows API

**API = Application Programming Interface**

- Riesige Bibliothek vorgefertigter Funktionen
- Jede App kann sie nutzen

### DLLs = Werkzeugkisten

**DLL = Dynamic Link Library**

Beispiele:

- `kernel32.dll` â†’ Dateien, Speicher, Prozesse
- `user32.dll` â†’ Fenster, GUI
- `advapi32.dll` â†’ Registry, Services
- `ws2_32.dll` â†’ Netzwerk
- `urlmon.dll` â†’ Internet-Downloads

---

## Import Address Table (IAT)

**Liste aller Funktionen, die ein Programm nutzen will**

### Warum IAT so wichtig?

**Sagt uns die Absichten der Malware!**

### Beispiele:

**1. Datei-Manipulation**

```
CreateFileA        â†’ Datei erstellen/Ã¶ffnen
WriteFile          â†’ In Datei schreiben
DeleteFile         â†’ Datei lÃ¶schen
```

â†’ **Vermutung:** Malware modifiziert Dateien

**2. Internet-Download**

```
URLDownloadToFileA â†’ Download von URL
InternetOpenA      â†’ Internet-Verbindung Ã¶ffnen
```

â†’ **Vermutung:** LÃ¤dt Payload nach

**3. Persistence**

```
RegSetValueExA     â†’ Registry Ã¤ndern
RegOpenKeyExA      â†’ Registry-Key Ã¶ffnen
```

â†’ **Vermutung:** Macht sich persistent

**4. Process Injection**

```
CreateRemoteThread â†’ Thread in anderem Prozess
VirtualAllocEx     â†’ Speicher in anderem Prozess
WriteProcessMemory â†’ In anderen Prozess schreiben
```

â†’ **Vermutung:** Injiziert Code in legitime Prozesse

---

## PE-Sections (Abschnitte)

### 1. .text Section

- **EnthÃ¤lt:** AusfÃ¼hrbarer Code
- **Was:** Die eigentlichen Programm-Anweisungen
- **Low-Level:** Assembly/Machine Code

### 2. .data Section

- **EnthÃ¤lt:** Initialisierte Daten
- **Was:** Variablen mit Startwerten

### 3. .rdata Section

- **EnthÃ¤lt:** Read-only Daten
- **Was:** Konstanten, Strings
- **Wichtig:** Hier finden wir oft Strings!

---

# Teil 3: Dynamische Malware-Analyse

## Was ist dynamische Analyse?

**Malware IN AKTION beobachten**

**Statisch** = Blueprints lesen **Dynamisch** = Maschine einschalten und beobachten

### Warum dynamische Analyse?

Manche Dinge sieht man nur beim AusfÃ¼hren:

- âš™ï¸ Echtes Verhalten
- ğŸ”“ Entpackter Code
- ğŸŒ Netzwerk-Kommunikation
- ğŸ“ Runtime-Entscheidungen

---

## Was kÃ¶nnen wir erkennen?

### 1. Dateisystem-Ã„nderungen

```
âœ… Neue Dateien erstellt?
   â†’ C:\Users\Public\malware_copy.exe
   
âœ… Systemdateien modifiziert?
   â†’ C:\Windows\System32\drivers\evil.sys
   
âœ… Dateien gelÃ¶scht?
   â†’ Ransomware lÃ¶scht Originale nach VerschlÃ¼sselung
```

### 2. Netzwerk-AktivitÃ¤t

```
âœ… Verbindungsversuche?
   â†’ DNS-Request zu evil-c2.com
   
âœ… IP-Verbindungen?
   â†’ TCP zu 192.168.1.100:4444
   
âœ… Daten-Upload?
   â†’ POST /exfil mit 50MB Daten
```

### 3. Registry-Modifikationen

```
âœ… Autostart-Keys?
   â†’ HKCU\...\Run = "C:\malware.exe"
   
âœ… Service-Installation?
   â†’ HKLM\System\Services\EvilSvc
```

### 4. Prozess-AktivitÃ¤t

```
âœ… Neue Prozesse gestartet?
   â†’ cmd.exe â†’ powershell.exe
   
âœ… Process Injection?
   â†’ Malware â†’ explorer.exe (Code injiziert)
   
âœ… Versteckte Prozesse?
   â†’ Rootkit-Techniken
```

---

## Die Sandbox - Kritische SicherheitsmaÃŸnahme

### âš ï¸ NIEMALS AUF ECHTEM SYSTEM!

**Sandbox = Isolierte Umgebung**

Typischerweise: **Virtuelle Maschine (VM)**

### Der sichere Workflow:

```
1. Saubere VM starten
   â†“
2. Snapshot erstellen (Backup)
   â†“
3. Malware in VM Ã¼bertragen
   â†“
4. Malware ausfÃ¼hren & analysieren
   â†“
5. VM auf Snapshot zurÃ¼cksetzen
   â†“
â†’ Alle Ã„nderungen gelÃ¶scht!
```

**Analogie:** Gepolsterter Raum - Malware kann toben, kein echter Schaden

---

## Das Spektrum der dynamischen Analyse

### 1. Automatisierte Analyse (Schnell)

**Online-Sandboxes:**

- ANY.RUN
- Joe Sandbox
- Hybrid Analysis

**Prozess:**

1. Datei hochladen
2. Automatische AusfÃ¼hrung
3. Detaillierter Report:
    - Netzwerk-Verbindungen
    - Gedroppte Dateien
    - Registry-Ã„nderungen
    - Risiko-Score

**Pro:** âš¡ Sehr schnell, viele Samples triagieren **Contra:** âš ï¸ Malware erkennt oft Sandbox und versteckt sich

---

### 2. Manuelle Analyse (Detailliert)

**Analyst nutzt Monitoring-Tools:**

**Process Monitor (ProcMon)**

- Ãœberwacht Dateisystem
- Registry-AktivitÃ¤t
- Prozess-/Thread-AktivitÃ¤t

**Wireshark**

- Netzwerk-Traffic aufzeichnen
- Paket-Analyse
- C2-Kommunikation sehen

**Pro:** ğŸ” Findet verstecktes Verhalten **Contra:** â±ï¸ Zeitaufwendig

**Trick:** Mit Malware interagieren

- Fake C2-Antworten senden
- Malware austricksen
- NÃ¤chste Stage aufdecken

---

### 3. Debugging (Tiefster Level)

**Mit Debugger Code durchlaufen**

**Tools:**

- x64dbg
- WinDbg
- IDA Pro (mit Debugger)

**FÃ¤higkeiten:**

- â¸ï¸ Programm pausieren
- ğŸ“Š Memory & Register inspizieren
- ğŸš¶ Schritt fÃ¼r Schritt durchgehen
- âœï¸ Code/Memory on-the-fly Ã¤ndern

**Pro:** ğŸ”¬ Unvergleichlicher Einblick **Contra:** ğŸ§  Braucht Assembly-Kenntnisse

**Ideal fÃ¼r:** Gepackte/verschleierte Malware

---

## Manuelle Analyse-Tools

### Process Monitor (ProcMon)

**Das HerzstÃ¼ck der manuellen Analyse**

**Problem:** Windows erzeugt Tausende Events/Sekunde!

**LÃ¶sung:** **FILTERN!**

**Typischer Workflow:**

```
1. ProcMon starten
2. Filter erstellen:
   â†’ Process Name = malware.exe
3. Malware starten
4. Nur Malware-Events sichtbar!
```

**Praxis-Beispiel:**

```bash
# Filter fÃ¼r ping.exe setzen
Filter â†’ Process Name = ping.exe

# In CMD ausfÃ¼hren
ping 8.8.8.8

# ProcMon zeigt nur ping-AktivitÃ¤ten!
```

---

### Wireshark

**Netzwerk-Traffic aufzeichnen**

**Was sehen wir?**

- ğŸ“¡ DNS-Requests
- ğŸŒ TCP/UDP-Verbindungen
- ğŸ“¦ Payload-Content
- ğŸ”’ VerschlÃ¼sselte vs. Klartext

**Typische Findings:**

```
DNS Query: evil-c2.com
   â†“
TCP Connect: 185.220.101.50:443
   â†“
HTTP POST: /upload (2MB Daten)
   â†“
â†’ Daten-Exfiltration erkannt!
```

---

### Debugger (x64dbg, WinDbg)

**MÃ¤chtigste Tools im Arsenal**

**Was kÃ¶nnen Debugger?**

**1. An Prozess anhÃ¤ngen**

```
x64dbg â†’ Attach â†’ malware.exe
```

**2. Breakpoints setzen**

```
Break bei: CreateFileA
â†’ Stoppt wenn Datei erstellt wird
```

**3. Memory inspizieren**

```
Dump memory region:
0x00400000 - 0x00450000
â†’ EntschlÃ¼sselter Code sichtbar!
```

**4. Code modifizieren**

```
Ã„ndere Sprung-Instruktion:
JNE â†’ JMP
â†’ Andere AusfÃ¼hrungs-Pfade
```

**Kritisch fÃ¼r:** Packed Malware

- Code ist verschlÃ¼sselt/komprimiert
- Entpackt sich zur Runtime
- Nur im Debugger sichtbar!

---

### Process Explorer

**Task Manager auf Steroiden**

**Cool Feature: Memory Strings**

**Praxis:**

```
1. Notepad Ã¶ffnen
2. Text eingeben: "Secret Message 123"
3. NICHT speichern!
4. Process Explorer â†’ notepad.exe â†’ Properties
5. Strings-Tab â†’ Image auswÃ¤hlen
6. â†’ "Secret Message 123" gefunden!
```

**Das bedeutet:**

- Text ist im Memory
- Noch nicht auf Festplatte
- Analysten kÃ¶nnen Memory durchsuchen!

---

## Anti-Sandbox-Techniken

### Warum versteckt sich Malware?

**Malware ist sandbox-bewusst!**

### HÃ¤ufige Tricks:

**1. Zeit-VerzÃ¶gerung**

```c
Sleep(1800000); // 30 Minuten warten
// Dann erst schÃ¤dlich werden
```

â†’ Automated Sandbox hat Timeout!

**2. VM-Erkennung**

```
PrÃ¼fe auf:
- VMware-Treiber
- VirtualBox-Prozesse
- Hypervisor-Flags
â†’ Wenn VM: Harmloses Verhalten
```

**3. User-Interaktion fordern**

```
"Klicken Sie auf OK zum Fortfahren"
â†’ Sandbox klickt nicht = Keine AktivitÃ¤t
```

**4. Internet-Check**

```
Ping google.com
â†’ Keine Antwort? = Sandbox!
```

### Gegen-Taktiken:

**FÃ¼r Analysten:**

- â° Zeitstempel manipulieren
- ğŸ–±ï¸ Klicks automatisieren
- ğŸŒ Fake-Internetantworten
- ğŸ”§ VM-Artefakte verstecken

---

# Teil 4: Malware Defense

## Defense-in-Depth Philosophie

**Kein einzelnes Tool ist narrensicher!**

### Die Burg-Analogie:

```
ğŸ° Mittelalterliche Burg-Verteidigung:

1. Graben (Verlangsamt)
   â†“
2. Steinmauern (PrimÃ¤re Barriere)
   â†“
3. BogenschÃ¼tzen (Aktive Defense)
   â†“
4. Wachen (Interne Detection)
   â†“
5. Festung (Kritische Assets)

â†’ Angreifer muss ALLES Ã¼berwinden!
```

### In Cybersecurity:

**Mehrere Schichten:**

- ğŸŒ Netzwerk (Firewalls)
- ğŸ’» Endpoint (AV, EDR)
- ğŸ‘¤ Menschen (Training)
- ğŸ“‹ Prozesse (Policies)

**Prinzip:** Ausfall einer Schicht â‰  komplette Kompromittierung

---

## Defense-Technologien

### 1. Antivirus (AV)

**Der klassische TÃ¼rsteher**

#### Signatur-basierte Erkennung

**Wie es funktioniert:**

```
1. AV hat Datenbank mit Malware-Hashes
   
2. Neue Datei scannen
   â†“
   Hash berechnen: SHA-256
   â†“
   Mit Datenbank vergleichen
   â†“
   Match? â†’ BLOCKIEREN!
```

**Beispiel:**

```
Malware.exe â†’ Hash: 3f7865...
Datenbank hat: 3f7865...
â†’ ERKANNT!

Malware.exe (1 Bit geÃ¤ndert)
â†’ Hash: 8a2bc1...
Datenbank hat NICHT 8a2bc1...
â†’ NICHT ERKANNT!
```

**Problem:** 1 Byte Ã„nderung = Anderer Hash

**Deshalb:** Polymorphe Malware

- Ã„ndert sich bei jeder Kopie
- Umgeht Signatur-Detection

---

#### Heuristische & Verhaltens-Analyse

**Intelligentere Methode**

Sucht nach **verdÃ¤chtigem Verhalten**, nicht spezifischen Dateien

**Fragen, die AV stellt:**

**1. Ransomware-Verdacht?**

```
VerschlÃ¼sselt Programm viele Dateien schnell?
   â†“
LÃ¶scht es danach Backups?
   â†“
â†’ JA = STOPPEN!
```

**2. Dropper-Verdacht?**

```
Word-Dokument startet PowerShell?
   â†“
PowerShell lÃ¤dt von Internet?
   â†“
â†’ JA = BLOCKIEREN!
```

**3. Persistence-Verdacht?**

```
Ã„ndert Programm Registry Autostart-Keys?
   â†“
Modifiziert es System-Dateien?
   â†“
â†’ JA = WARNEN!
```

**4. Evasion-Verdacht?**

```
EnthÃ¤lt Code, der Debugger erkennt?
   â†“
Versteckt es Strings?
   â†“
â†’ JA = VERDÃ„CHTIG!
```

**Vorteil:** Findet Zero-Days & Polymorphe Malware

---

### 2. YARA - Pattern Matching

**Flexible, selbst-erstellte Signaturen**

**Analogie:** grep fÃ¼r Malware-Dateien

### YARA-Rule Struktur:

```yara
rule Keylogger_Detection {
    meta:
        author = "Security Analyst"
        description = "Erkennt potenzielle Keylogger"
        date = "2024-01-15"
    
    strings:
        $text1 = "keylogger" nocase
        $text2 = "keystroke"
        $hex1 = { E8 ?? ?? ?? ?? 8B C8 }  // Byte-Pattern
        $api1 = "GetAsyncKeyState"        // Windows API
        $api2 = "SetWindowsHookEx"
    
    condition:
        $hex1 and ($api1 or $api2) and any of ($text*)
}
```

### Sections erklÃ¤rt:

**1. meta** (Metadaten)

- Autor, Datum, Beschreibung
- Dokumentation

**2. strings** (Muster)

- Text-Strings
- Hex-Sequenzen
- Regular Expressions

**3. condition** (Logik)

- Wann ist Datei ein Match?
- Boolean-Logik (AND, OR, NOT)

### Einsatz:

**Nicht fÃ¼r Echtzeit-AV!**

Sondern fÃ¼r:

- ğŸ” Threat Hunting
- ğŸ“ Filesystem-Scans
- ğŸ¢ Enterprise-Suche nach spezifischen Threats
- ğŸ§ª Malware-Klassifizierung

---

### 3. Endpoint Detection & Response (EDR)

**AV = TÃ¼rsteher** **EDR = VollstÃ¤ndiges Security-Team mit Kameras**

### Philosophie:

**"Prevention wird manchmal versagen"**

â†’ Ziel: Erkennen & Reagieren BEVOR groÃŸer Schaden

---

### EDR-FÃ¤higkeiten:

#### A) Deep Visibility (Tiefe Sichtbarkeit)

**Kontinuierliche Aufzeichnung:**

- ğŸ“ Alle Dateisystem-AktivitÃ¤ten
- ğŸ”§ Prozess-Starts/-Stops
- ğŸŒ Netzwerk-Verbindungen
- ğŸ“ Registry-Ã„nderungen
- ğŸ‘¤ User-Logins
- ğŸ’¾ Memory-AktivitÃ¤ten

**Wie ein Videorecorder fÃ¼r das System!**

---

#### B) Response-FÃ¤higkeiten

**Remote-Aktionen bei Bedrohung:**

**1. Host isolieren**

```
ğŸ”´ Netzwerk trennen (1 Klick)
   â†’ Keine Kommunikation mit anderen Hosts
   âœ… Kann noch mit EDR-Server sprechen
```

**2. Prozess beenden**

```
ğŸ”´ Kill malware.exe
   â†’ Sofortiger Stop
```

**3. Datei quarantÃ¤nen/lÃ¶schen**

```
ğŸ”´ C:\Temp\malware.exe â†’ QuarantÃ¤ne
   â†’ Kann nicht mehr ausgefÃ¼hrt werden
```

**4. Scripts remote ausfÃ¼hren**

```
ğŸ”´ Investigation-Script starten
   ğŸ” Memory-Dump erstellen
   ğŸ” Weitere Artifacts sammeln
```

**5. Live-Investigation**

```
ğŸ”´ Dateisystem durchstÃ¶bern
ğŸ”´ Prozessliste einsehen
ğŸ”´ Netzwerk-Verbindungen prÃ¼fen
   â†’ Alles in Echtzeit!
```

---

### EDR vs. AV - Der Unterschied

```
ANTIVIRUS:
- Fokus: PrÃ¤vention
- Methode: Bekannte Signaturen + Heuristik
- Reaktion: Blockieren/LÃ¶schen
- Visibility: Begrenzt

EDR:
- Fokus: Detection & Response
- Methode: Behavioral Analytics + ML
- Reaktion: Umfassende Response-Optionen
- Visibility: Alles wird aufgezeichnet
- Threat Hunting mÃ¶glich
```

---

### 4. Firewalls

**Netzwerk-Level Defense**

### Was blockiert eine Firewall?

**1. Ingress (Eingehend)**

```
ğŸŒ Internet â†’ Dein Server
   â†“
Firewall prÃ¼ft:
   Port 22 (SSH) von 1.2.3.4?
   â†’ Erlaubt?
   âœ… JA â†’ Durchlassen
   âŒ NEIN â†’ Blockieren
```

**2. C2-Kommunikation verhindern**

```
Infizierter PC â†’ evil-c2.com
   â†“
Next-Gen Firewall (NGFW):
   "evil-c2.com ist bekannter C2!"
   âŒ BLOCKIEREN!
```

**3. Daten-Exfiltration stoppen**

```
PC â†’ Unbekannte IP (50GB Upload)
   â†“
Firewall:
   "UngewÃ¶hnlich viel ausgehender Traffic!"
   âŒ BLOCKIEREN & ALARMMIEREN!
```

### Firewall-Typen:

**Traditional Firewall:**

- Port-basiert
- IP-basiert
- Stateful Inspection

**Next-Gen Firewall (NGFW):**

- All das oben +
- Deep Packet Inspection
- Threat Intelligence Integration
- Application Awareness

---

### 5. Application Allowlisting

**Die strengste Kontrolle**

### Philosophie:

```
Blacklist: Alles erlauben, auÃŸer Schlechtes
   â†’ Problem: Unendlich viel Schlechtes!

Allowlist: Alles blockieren, auÃŸer Gutes
   â†’ âœ… Nur bekannte Apps laufen
```

### Wie es funktioniert:

**1. Liste erstellen:**

```
Erlaubte Programme:
âœ… C:\Program Files\Chrome\chrome.exe
âœ… C:\Windows\System32\notepad.exe
âœ… C:\Program Files\Office\WINWORD.exe
```

**2. Alles andere blockieren:**

```
User versucht: C:\Temp\malware.exe
   â†“
Nicht auf Liste!
   âŒ BLOCKIERT!
```

### Windows: AppLocker

**Regeltypen:**

- ğŸ“ Executable Rules (.exe, .com)
- ğŸ“œ Script Rules (.ps1, .bat, .js)
- ğŸ“¦ Windows Installer Rules (.msi)
- ğŸ“š DLL Rules (.dll)

### macOS: Gatekeeper

**Settings:**

- ğŸ›‘ Nur App Store
- âš ï¸ App Store + Identifizierte Entwickler
- ğŸ”“ Alles (unsicher!)

**Vorteil:** Extrem effektiv gegen Malware **Nachteil:** Admin-Overhead hoch

---

## Die menschliche Schicht

**"Der Mensch ist das schwÃ¤chste Glied"**

### 1. Patch Management

**Ungepatchte Schwachstellen = Offene TÃ¼r**

**Best Practices:**

- ğŸ“… RegelmÃ¤ÃŸiger Zeitplan (z.B. Patch Tuesday)
- ğŸ”„ Automatische Updates wo mÃ¶glich
- ğŸ§ª Testen vor Deployment
- âš¡ Critical Patches sofort

**Nicht patchen = HaustÃƒÂ¼r offen lassen**

### 2. Security Awareness Training

**Trainierter User = Security Asset**

**Was trainieren?**

**Phishing erkennen:**

```
âŒ "Klicken Sie hier um Ihr Konto zu verifizieren"
âŒ Dringlichkeit ("Sofort handeln!")
âŒ UngewÃ¶hnlicher Absender
âŒ Rechtschreibfehler
```

**Sichere Praktiken:**

```
âœ… Starke, einzigartige PasswÃ¶rter
âœ… 2FA aktivieren
âœ… USB-Sticks nicht einfach einstecken
âœ… VerdÃ¤chtiges melden
```

**Kontinuierlich & Engaging:**

- Nicht nur 1Ã— jÃ¤hrlich
- Gamification
- Simulated Phishing
- Sicherheitskultur aufbauen

---

# Schnell-Referenz

## Malware-Typen

- **Viren/WÃ¼rmer** â†’ Verbreiten sich
- **Trojaner** â†’ Tarnen sich
- **Ransomware** â†’ VerschlÃ¼sseln
- **Spyware** â†’ Ausspionieren
- **Rootkits** â†’ Verstecken sich

## Wichtige IoCs

- **Hashes** (MD5, SHA-1, SHA-256)
- **IPs & Domains**
- **Registry-Keys**
- **Dateipfade**
- **URLs**

## Analyse-Arten

- **Statisch** â†’ Ohne AusfÃ¼hrung
- **Dynamisch** â†’ In Aktion beobachten
- **Debugging** â†’ Tiefster Level

## Statische Tools

- **Hashing** â†’ Identifikation
- **Strings** â†’ Lesbare Zeichen
- **FLOSS** â†’ Deobfuskation
- **PE-Parser** â†’ Header analysieren

## Dynamische Tools

- **Process Monitor** â†’ System-AktivitÃ¤t
- **Wireshark** â†’ Netzwerk
- **Process Explorer** â†’ Memory
- **Debugger** â†’ Code-Level

## Defense-Tools

- **Antivirus** â†’ Signatur + Heuristik
- **YARA** â†’ Custom Patterns
- **EDR** â†’ Detection & Response
- **Firewall** â†’ Netzwerk-Kontrolle
- **Allowlisting** â†’ Nur Gutes erlauben

## Wichtige Windows-APIs

```
CreateFileA       â†’ Datei erstellen
WriteFile         â†’ Schreiben
RegSetValueExA    â†’ Registry Ã¤ndern
URLDownloadToFile â†’ Download
CreateRemoteThread â†’ Process Injection
VirtualAllocEx    â†’ Memory in anderem Prozess
InternetOpenA     â†’ Internet-Verbindung
```

## Persistence-Locations

```
Registry:
HKCU\...\Run
HKLM\...\Run

Dateisystem:
%APPDATA%\Roaming\...\Startup
C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup

Services:
HKLM\System\CurrentControlSet\Services
```

## Sandbox-Workflow

```
1. Clean VM + Snapshot
2. Malware Ã¼bertragen
3. AusfÃ¼hren & Beobachten
4. Revert zu Snapshot
```

## VirusTotal Workflow

```
1. Hash/File/URL suchen
2. Ergebnisse analysieren
3. Relations prÃ¼fen
4. Pivot zu verwandten IoCs
5. Komplettes Bild aufbauen
```

---

# Best Practices

## FÃ¼r Analysten

1. âš ï¸ **NIEMALS auf echtem System!**
2. ğŸ“¸ **Snapshots vor jeder Analyse**
3. ğŸ” **Immer Filtern** (ProcMon)
4. ğŸ“ **Dokumentieren** (Screenshots, Notes)
5. ğŸ”„ **IoCs mit Community teilen**

## FÃ¼r Defender

1. ğŸ›¡ï¸ **Defense-in-Depth** anwenden
2. ğŸ”„ **RegelmÃ¤ÃŸig patchen**
3. ğŸ‘¥ **User trainieren**
4. ğŸ“Š **Logs monitoren**
5. ğŸ§ª **Incident Response Plan** haben

## FÃ¼r Organisationen

1. ğŸ“‹ **Policies definieren**
2. ğŸ”’ **Least Privilege** Prinzip
3. ğŸ¯ **Security Awareness Programm**
4. ğŸš¨ **Incident Response Team**
5. ğŸ§ª **RegelmÃ¤ÃŸige Tests** (Red Team)

---

**Erfolg beim Lernen & Stay Safe!** ğŸ”’ğŸ›¡ï¸