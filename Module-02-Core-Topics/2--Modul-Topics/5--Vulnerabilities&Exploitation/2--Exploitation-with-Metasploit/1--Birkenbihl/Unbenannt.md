Welcome to the world of exploitation! In our last session, we discussed how to find vulnerabilities. Now, we'll learn how to leverage them. This pre-class material introduces the Metasploit Framework, one of the most powerful and widely used tools for penetration testing. Understanding its fundamentals is crucial for any aspiring ethical hacker.

![Metasploit_logo_and_wordmark.svg](attachment:e41db365-1da2-4156-9baa-dc9b34622512:Metasploit_logo_and_wordmark.svg)

### What is the Metasploit Framework?

The Metasploit Framework is an open-source platform for developing, testing, and executing exploits. Think of it as a massive, organized library of tools and code snippets designed to take advantage of security vulnerabilities in systems, networks, and applications. Created by H.D. Moore in 2003 and now owned by the cybersecurity company Rapid7, it was designed to make penetration testing more systematic and manageable, saving security professionals from having to write custom code for every single flaw they find.

At its core, Metasploit allows you to:

- **Find**Â an existing exploit for a known vulnerability.
- **Configure**Â that exploit to target a specific machine.
- **Deliver**Â a "payload" to the target, which is the code that runs after the exploit is successful.
- **Gain**Â control or access to the compromised system.

It's the ethical hacker's "Swiss Army knife" for exploitation, providing a standardized way to approach a vast range of vulnerabilities.

### Core Metasploit Components

![image.png](attachment:f14596a3-ffec-4b9c-b70a-bdce0bdeb290:image.png)

As you dive into Metasploit, you'll encounter specific terms frequently. Understanding them is key.

- **Vulnerability:**Â A weakness in a system that can be attacked (e.g., an unpatched piece of software).
- **Exploit:**Â The piece of code that takes advantage of a specific vulnerability to gain access. Metasploit has a huge database of these, categorized by target system.
- **Payload:**Â The code that you want to run on the target systemÂ _after_Â the exploit is successful. Payloads determine what you canÂ _do_Â after you get in.
- **Module:**Â In Metasploit, everything is a module. This modular structure makes the framework highly flexible and easy to extend. The main types are:
    - **Exploit Modules:**Â As described, these are for exploiting a vulnerability.
    - **Payload Modules:**Â These are the code to be run on the target.
    - **Auxiliary Modules:**Â These perform actions that don't involve exploitation, such as scanning, fuzzing, or sniffing. They are used for reconnaissance and information gathering.
    - **Post-Exploitation Modules:**Â These are usedÂ _after_Â you have successfully gained access to a system. They help with privilege escalation, pivoting to other systems, and gathering sensitive information from the compromised host.
- **Listener:**Â A process that "listens" on the attacker's machine for an incoming connection from a payload that has been successfully executed on a target. When you exploit a machine, the payload often needs to "call back" to you. The listener is what picks up that call.

### Payloads in Depth: Staged vs. Stageless

Not all payloads are created equal. Understanding the difference between staged and stageless payloads is crucial for choosing the right tool for the job.

- **Staged Payloads**Â These work in two parts. First, a small piece of code called a "stager" is sent to the target. The stager's only job is to connect back to the attacker's machine and download the rest of the payload (the "stage").
    
    - **Pros:**Â Smaller initial size, making it more likely to succeed in memory-constrained exploits. Can be more reliable over unstable networks.
        
    - **Cons:**Â Requires a second connection, which can be detected by firewalls or intrusion detection systems. The multi-step process can sometimes fail.
        
        ![image.png](attachment:5642a1bc-89f3-41d5-95b4-5ffddbdeba29:image.png)
        
- **Stageless Payloads** These deliver the entire payload in a single chunk. The exploit sends the full Meterpreter (or shell) code all at once.
    
    - **Pros:**Â Simpler and more self-contained. Only requires one connection.
    - **Cons:**Â Much larger in size, which can cause some exploits to fail.

### Key Interfaces:Â `msfconsole`Â andÂ `msfvenom`

While Metasploit has several tools, you will primarily interact with two:

- **`msfconsole`:**Â This is the main command-line interface you will use. It provides access to virtually all of the framework's options and modules. It's where you will search for exploits, configure them, set up listeners, and manage compromised sessions.
- **`msfvenom`:**Â This is a powerful command-line tool that combines payload generation and encoding. BeforeÂ `msfvenom`, these were two separate tools (`msfpayload`Â andÂ `msfencode`). You useÂ `msfvenom`Â to create standalone payload files that you can deliver to a target manually, for example, as part of a phishing campaign or hidden inside a legitimate-looking file.

### The Metasploit Workflow inÂ `msfconsole`

Using Metasploit typically follows a consistent pattern. The prompt in the console will change to reflect the module you are currently using.

1. **Search:**Â Find a relevant exploit.Â `msf6 > search eternalblue`
2. **Use:**Â Select the exploit module.Â `msf6 > use exploit/windows/smb/ms17_010_eternalblue`
3. **Show Options:**Â View the parameters you need to configure.Â `msf6 exploit(windows/smb/ms17_010_eternalblue) > show options`
4. **Set:**Â Configure the required options. The most common are:
    - `RHOSTS`: Remote Hosts, the IP address(es) of your target(s).
    - `LHOST`: Local Host, the IP address of your attacking machine (your Kali Linux VM), for the payload to connect back to.Â `msf6 exploit(windows/smb/ms17_010_eternalblue) > set RHOSTS 192.168.1.10`
5. **Exploit / Run:**Â Launch the attack.Â `msf6 exploit(windows/smb/ms17_010_eternalblue) > exploit`

This cycle is the bread and butter of working withinÂ `msfconsole`.

### Think about it

- You are performing a penetration test. You find a vulnerability, but the target system is behind a firewall that inspects the size of incoming packets. Would a staged or stageless payload be a better choice, and why?
- Why isÂ `msfvenom`Â a separate tool? Why not just generate all payloads from withinÂ `msfconsole`?

<aside> ðŸ“Œ

The slides for the live session can be viewed here: [https://gamma.app/docs/Module-2-Week-5-Session-2-Exploitation-with-Metasploit-aox3zjg65tb5sb1?mode=doc](https://gamma.app/docs/Module-2-Week-5-Session-2-Exploitation-with-Metasploit-aox3zjg65tb5sb1?mode=doc)

Try not to peek before class - spoilers inside!

</aside>